<VirtualHost *:80>
    ServerAdmin webmaster@localhost
    DocumentRoot /srv/exp/jka/templates
    Redirect permanent / https://www.rootairs.com/

    <Directory /srv/exp/jka/templates>
       DirectoryIndex main/main.html
       Options -Indexes -FollowSymLinks
       AllowOverride None
       Require all granted
    </Directory>


    <Directory /srv/exp/jka/templates/admin> 
       DirectoryIndex admin.html
       Options -Indexes -FollowSymLinks
       AllowOverride None
       Require all granted
    </Directory>

#    Header set Access-Control-Allow-Origin "*"
    Header set Access-Control-Allow-Methods "GET, POST, OPTIONS"
    Header set Access-Control-Allow-Headers "Content-Type"

    Alias /static/ "/srv/exp/jka/static/"
    <Directory /srv/exp/jka/static>
        Options -Indexes -FollowSymLinks
        AllowOverride None
        Require all granted
    </Directory>

    Alias /uploads/ "/srv/exp/jka/uploads/"
    <Directory "/srv/exp/jka/uploads">
        Options -FollowSymLinks
        AllowOverride None
        Require all granted
        <FilesMatch "\.(php|sh|exe|cgi)$">
           Require all denied
        </FilesMatch>
        <FilesMatch "\.(png|jpg|jpeg|gif|pdf|txt|csv|mp4|mp3)$">
           Header set Content-Disposition "attachment"
        </FilesMatch>
    </Directory>

    RewriteEngine On
    RewriteCond %{DOCUMENT_ROOT}/%{REQUEST_URI}.html -f
    RewriteRule ^(.+)$ /%{REQUEST_URI}.html [L]
    RewriteCond %{DOCUMENT_ROOT}/%{REQUEST_URI}/$1.html -f
    RewriteRule ^([^/]+)/$ /$1/$1.html [L]

    # Flask API 프록시 설정
    ProxyPass "/api" "http://10.0.3.150:5000/api"
    ProxyPassReverse "/api" "http://10.0.3.150:5000/api"

    # Apache가 /api/ 요청을 직접 처리하지 못하도록 함
    #ProxyPassMatch "^/api/.*$" "http://10.0.3.150:5000/"

    <Proxy *>
        Require all granted
    </Proxy>

    RequestHeader set X-Forwarded-For %{REMOTE_ADDR}s
    RequestHeader set X-Forwarded-Proto "https"

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
RewriteCond %{SERVER_NAME} =www.rootairs.com
RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
</VirtualHost>
